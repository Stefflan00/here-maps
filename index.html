<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="initial-scale=1.0, width=device-width" />
<link rel="stylesheet" type="text/css" href="https://js.cit.api.here.com/v3/3.0/mapsjs-ui.css" />
<script type="text/javascript" src="https://js.cit.api.here.com/v3/3.0/mapsjs-core.js"></script>
<script type="text/javascript" src="https://js.cit.api.here.com/v3/3.0/mapsjs-service.js"></script>
<script type="text/javascript" src="https://js.cit.api.here.com/v3/3.0/mapsjs-ui.js"></script>
<script type="text/javascript" src="https://js.cit.api.here.com/v3/3.0/mapsjs-mapevents.js"></script>
<script
  src="https://code.jquery.com/jquery-1.12.4.min.js"
  integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ="
  crossorigin="anonymous"></script>
</head>
<body>
  <div id="map" style="width: 100%; height: 100vh; background: grey" />
  <script  type="text/javascript" charset="UTF-8" >

  function getIcons() {
    var greenIcon = `<svg width="80px" height="80px" viewBox="0 0 80 80" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <!-- Generator: Sketch 42 (36781) - http://www.bohemiancoding.com/sketch -->
    <title>icon-parking-green</title>
    <desc>Created with Sketch.</desc>
    <defs>
        <circle id="path-1" cx="40.5" cy="40.5" r="21.5"></circle>
        <filter x="-50%" y="-50%" width="200%" height="200%" filterUnits="objectBoundingBox" id="filter-2">
            <feOffset dx="0" dy="0" in="SourceAlpha" result="shadowOffsetOuter1"></feOffset>
            <feGaussianBlur stdDeviation="2" in="shadowOffsetOuter1" result="shadowBlurOuter1"></feGaussianBlur>
            <feColorMatrix values="0 0 0 0 0   0 0 0 0 0   0 0 0 0 0  0 0 0 0.5 0" type="matrix" in="shadowBlurOuter1"></feColorMatrix>
        </filter>
        <path d="M28.6142578,35.9023438 L35.8759766,39.5332031 L35.8759766,39.7158203 L28.6142578,43.3466797 L28.6142578,46.0537109 L38.5722656,40.671875 L38.5722656,38.5664062 L28.6142578,33.1845703 L28.6142578,35.9023438 Z M49.8300781,46 L49.8300781,43.078125 L42.2568359,43.078125 L42.2568359,40.6826172 C42.6005877,40.0380827 42.9944639,39.3398475 43.4384766,38.5878906 C43.8824892,37.8359337 44.3712538,37.0320681 44.9047852,36.1762695 C45.4383165,35.320471 46.0112274,34.4181363 46.6235352,33.4692383 C47.2358429,32.5203403 47.8857388,31.5302786 48.5732422,30.4990234 L52.4833984,30.4990234 L52.4833984,40.7900391 L54.578125,40.7900391 L54.578125,43.078125 L52.4833984,43.078125 L52.4833984,46 L49.8300781,46 Z M44.8242188,40.6933594 L44.8242188,40.8544922 L49.8837891,40.8544922 L49.8837891,32.7119141 L49.7226562,32.7119141 C49.35742,33.2633491 48.9796569,33.8398407 48.5893555,34.4414062 C48.199054,35.0429718 47.7998067,35.6731738 47.3916016,36.3320312 C46.9833964,36.9908887 46.568036,37.6837529 46.1455078,38.4106445 C45.7229797,39.1375362 45.2825544,39.8984335 44.8242188,40.6933594 Z" id="path-3"></path>
        <filter x="-50%" y="-50%" width="200%" height="200%" filterUnits="objectBoundingBox" id="filter-4">
            <feOffset dx="0" dy="2" in="SourceAlpha" result="shadowOffsetOuter1"></feOffset>
            <feGaussianBlur stdDeviation="2" in="shadowOffsetOuter1" result="shadowBlurOuter1"></feGaussianBlur>
            <feColorMatrix values="0 0 0 0 0   0 0 0 0 0   0 0 0 0 0  0 0 0 0.5 0" type="matrix" in="shadowBlurOuter1"></feColorMatrix>
        </filter>
    </defs>
    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g id="icon-parking-green">
            <circle id="Oval-2" fill="#42CE53" opacity="0.170742754" cx="40" cy="40" r="40"></circle>
            <circle id="Oval-2" fill="#42CE53" opacity="0.347599638" cx="40.5" cy="40.5" r="28.5"></circle>
            <g id="Oval-2" opacity="0.63111413">
                <use fill="black" fill-opacity="1" filter="url(#filter-2)" xlink:href="#path-1"></use>
                <use fill="#42CE53" fill-rule="evenodd" xlink:href="#path-1"></use>
            </g>
            <g id="&gt;4">
                <use fill="black" fill-opacity="1" filter="url(#filter-4)" xlink:href="#path-3"></use>
                <use fill="#FFFFFF" fill-rule="evenodd" xlink:href="#path-3"></use>
            </g>
        </g>
    </g>
</svg>`;

    var redIcon = `<svg width="80px" height="80px" viewBox="0 0 80 80" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <!-- Generator: Sketch 42 (36781) - http://www.bohemiancoding.com/sketch -->
    <title>icon-parking-red</title>
    <desc>Created with Sketch.</desc>
    <defs>
        <circle id="path-1" cx="40.5" cy="40.5" r="21.5"></circle>
        <filter x="-50%" y="-50%" width="200%" height="200%" filterUnits="objectBoundingBox" id="filter-2">
            <feOffset dx="0" dy="0" in="SourceAlpha" result="shadowOffsetOuter1"></feOffset>
            <feGaussianBlur stdDeviation="2" in="shadowOffsetOuter1" result="shadowBlurOuter1"></feGaussianBlur>
            <feColorMatrix values="0 0 0 0 0   0 0 0 0 0   0 0 0 0 0  0 0 0 0.5 0" type="matrix" in="shadowBlurOuter1"></feColorMatrix>
        </filter>
        <path d="M39.8925781,46 L42.6640625,46 L42.6640625,30.4990234 L39.9033203,30.4990234 L39.2910156,30.9287109 C38.8828105,31.2151707 38.4101589,31.5463848 37.8730469,31.9223633 C37.3359348,32.2983417 36.8650736,32.6295559 36.4604492,32.9160156 L35.8535156,33.3457031 L35.8535156,35.9560547 L36.4335938,35.5478516 C36.8203144,35.2757148 37.2679011,34.9588234 37.7763672,34.597168 C38.2848333,34.2355125 38.7342103,33.9168308 39.1245117,33.6411133 L39.7099609,33.2275391 L39.8925781,33.2275391 L39.8925781,46 Z" id="path-3"></path>
        <filter x="-50%" y="-50%" width="200%" height="200%" filterUnits="objectBoundingBox" id="filter-4">
            <feOffset dx="0" dy="2" in="SourceAlpha" result="shadowOffsetOuter1"></feOffset>
            <feGaussianBlur stdDeviation="2" in="shadowOffsetOuter1" result="shadowBlurOuter1"></feGaussianBlur>
            <feColorMatrix values="0 0 0 0 0   0 0 0 0 0   0 0 0 0 0  0 0 0 0.5 0" type="matrix" in="shadowBlurOuter1"></feColorMatrix>
        </filter>
    </defs>
    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g id="icon-parking-red">
            <circle id="Oval-2" fill="#D0011B" opacity="0.170742754" cx="40" cy="40" r="40"></circle>
            <circle id="Oval-2" fill="#D0011B" opacity="0.347599638" cx="40.5" cy="40.5" r="28.5"></circle>
            <g id="Oval-2" opacity="0.63111413">
                <use fill="black" fill-opacity="1" filter="url(#filter-2)" xlink:href="#path-1"></use>
                <use fill="#D0011B" fill-rule="evenodd" xlink:href="#path-1"></use>
            </g>
            <g id="1">
                <use fill="black" fill-opacity="1" filter="url(#filter-4)" xlink:href="#path-3"></use>
                <use fill="#FFFFFF" fill-rule="evenodd" xlink:href="#path-3"></use>
            </g>
        </g>
    </g>
</svg>`;

    var yellowIcon = `<svg width="80px" height="80px" viewBox="0 0 80 80" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <!-- Generator: Sketch 42 (36781) - http://www.bohemiancoding.com/sketch -->
    <title>icon-parking-yellow</title>
    <desc>Created with Sketch.</desc>
    <defs>
        <circle id="path-1" cx="40.5" cy="40.5" r="21.5"></circle>
        <filter x="-50%" y="-50%" width="200%" height="200%" filterUnits="objectBoundingBox" id="filter-2">
            <feOffset dx="0" dy="0" in="SourceAlpha" result="shadowOffsetOuter1"></feOffset>
            <feGaussianBlur stdDeviation="2" in="shadowOffsetOuter1" result="shadowBlurOuter1"></feGaussianBlur>
            <feColorMatrix values="0 0 0 0 0   0 0 0 0 0   0 0 0 0 0  0 0 0 0.5 0" type="matrix" in="shadowBlurOuter1"></feColorMatrix>
        </filter>
        <path d="M22.065918,37.0214844 L22.065918,37.0537109 L24.6655273,37.0537109 L24.6655273,37.0214844 C24.6655273,36.219397 24.9161759,35.5712915 25.4174805,35.0771484 C25.9187851,34.5830053 26.5740519,34.3359375 27.3833008,34.3359375 C28.1424192,34.3359375 28.7726212,34.5615212 29.2739258,35.0126953 C29.7752304,35.4638694 30.0258789,36.0331997 30.0258789,36.7207031 C30.0258789,37.2792997 29.8522153,37.8289361 29.5048828,38.3696289 C29.1575503,38.9103217 28.4503634,39.7177681 27.3833008,40.7919922 L22.2163086,46.1308594 L22.2163086,48 L32.9799805,48 L32.9799805,45.7011719 L26.0297852,45.7011719 L26.0297852,45.5185547 L29.2631836,42.1992188 C30.5808985,40.8886653 31.4903946,39.8287801 31.9916992,39.0195312 C32.4930038,38.2102824 32.7436523,37.3938843 32.7436523,36.5703125 C32.7436523,35.2740821 32.2477263,34.2070354 31.2558594,33.3691406 C30.2639924,32.5312458 29.001798,32.1123047 27.4692383,32.1123047 C25.8793866,32.1123047 24.5813852,32.5688431 23.5751953,33.4819336 C22.5690054,34.3950241 22.065918,35.5748626 22.065918,37.0214844 Z M43.2495117,42.9726562 L43.2495117,40.5341797 L36.1918945,40.5341797 L36.1918945,42.9726562 L43.2495117,42.9726562 Z M50.1782227,41.1035156 L52.1225586,41.1035156 C53.0750373,41.1035156 53.8269829,41.3255186 54.378418,41.7695312 C54.929853,42.2135439 55.2055664,42.8222618 55.2055664,43.5957031 C55.2055664,44.333337 54.924482,44.9366839 54.3623047,45.4057617 C53.8001274,45.8748396 53.075037,46.109375 52.1870117,46.109375 C51.2989864,46.109375 50.5721057,45.8945334 50.0063477,45.4648438 C49.4405896,45.0351541 49.1254886,44.4550818 49.0610352,43.7246094 L46.4077148,43.7246094 C46.4793298,45.1282622 47.0397083,46.2561806 48.0888672,47.1083984 C49.1380261,47.9606162 50.4968992,48.3867188 52.1655273,48.3867188 C53.85564,48.3867188 55.2556911,47.9462935 56.3657227,47.0654297 C57.4757542,46.1845659 58.0307617,45.0817124 58.0307617,43.7568359 C58.0307617,42.7184193 57.7246124,41.8644239 57.1123047,41.1948242 C56.4999969,40.5252245 55.663905,40.1259772 54.6040039,39.9970703 L54.6040039,39.8144531 C55.4633832,39.6282543 56.1455053,39.2146842 56.6503906,38.5737305 C57.155276,37.9327767 57.4077148,37.1539759 57.4077148,36.2373047 C57.4077148,35.0556582 56.9082081,34.0727578 55.9091797,33.2885742 C54.9101513,32.5043906 53.6586989,32.1123047 52.1547852,32.1123047 C50.543449,32.1123047 49.2508187,32.5240844 48.2768555,33.3476562 C47.3028923,34.1712281 46.780111,35.2919851 46.7084961,36.7099609 L49.2973633,36.7099609 C49.3546552,35.972327 49.632159,35.3904644 50.1298828,34.9643555 C50.6276067,34.5382466 51.2775025,34.3251953 52.0795898,34.3251953 C52.8816772,34.3251953 53.5244116,34.5346659 54.0078125,34.9536133 C54.4912134,35.3725607 54.7329102,35.9257778 54.7329102,36.6132812 C54.7329102,37.3222692 54.4858423,37.8969705 53.9916992,38.3374023 C53.4975561,38.7778342 52.856612,38.9980469 52.0688477,38.9980469 L50.1782227,38.9980469 L50.1782227,41.1035156 Z" id="path-3"></path>
        <filter x="-50%" y="-50%" width="200%" height="200%" filterUnits="objectBoundingBox" id="filter-4">
            <feOffset dx="0" dy="2" in="SourceAlpha" result="shadowOffsetOuter1"></feOffset>
            <feGaussianBlur stdDeviation="2" in="shadowOffsetOuter1" result="shadowBlurOuter1"></feGaussianBlur>
            <feColorMatrix values="0 0 0 0 0   0 0 0 0 0   0 0 0 0 0  0 0 0 0.5 0" type="matrix" in="shadowBlurOuter1"></feColorMatrix>
        </filter>
    </defs>
    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g id="icon-parking-yellow">
            <circle id="Oval-2" fill="#F8E81C" opacity="0.170742754" cx="40" cy="40" r="40"></circle>
            <circle id="Oval-2" fill="#F8E81C" opacity="0.347599638" cx="40.5" cy="40.5" r="28.5"></circle>
            <g id="Oval-2" opacity="0.63111413">
                <use fill="black" fill-opacity="1" filter="url(#filter-2)" xlink:href="#path-1"></use>
                <use fill="#F8E81C" fill-rule="evenodd" xlink:href="#path-1"></use>
            </g>
            <g id="2-3">
                <use fill="black" fill-opacity="1" filter="url(#filter-4)" xlink:href="#path-3"></use>
                <use fill="#FFFFFF" fill-rule="evenodd" xlink:href="#path-3"></use>
            </g>
        </g>
    </g>
</svg>`;
    return [greenIcon,redIcon,yellowIcon];
  }

  function randomGeo(location, radius) {
      var y0 = location.lat;
      var x0 = location.lng;
      var rd = radius / 111300;

      var u = Math.random();
      var v = Math.random();

      var w = rd * Math.sqrt(u);
      var t = 2 * Math.PI * v;
      var x = w * Math.cos(t);
      var y = w * Math.sin(t);

      var xp = x / Math.cos(y0);

      return {
          'lat': y + y0,
          'lng': xp + x0
      };
  }

function addMarkersToMap(map) {
  var locations = []
  for (var i = 0; i < 10; i += 1) {
    locations.push(randomGeo({lat:52.5160, lng:13.3779}, 500))
  }
  getNearestStreets(locations, map);
}

function getNearestStreets(locations, map) {
  var url = "https://roads.googleapis.com/v1/nearestRoads?key=AIzaSyAx7kI-uvtJJ4kd8d0QYFG3M3uSsX2eU4A"
  var points = "&points="
  for (var i = 0; i < locations.length; i += 1 ) {
    points = points + `${locations[i].lat},${locations[i].lng}|`
  }
  url = url + points.substring(0, points.length - 1);
  $.ajax({
  url: url,
  })
  .done(function(res) {
    for (var i = 0; i < res.snappedPoints.length; i += 1){
      var point = {lat: res.snappedPoints[i].location.latitude, lng: res.snappedPoints[i].location.longitude }
      map.addObject(new H.map.Marker(point,{icon: genIcon()}));
    }
  })
  .fail(function(err) {
    console.log('Error: ' + err.status);
  });
}

function genIcon(){
  //Create the svg mark-up

  var icons = getIcons()
  var randNum = Math.floor(Math.random() * 3)
  console.log(randNum);
  return new H.map.Icon(icons[randNum])
}



/**
 * Boilerplate map initialization code starts below:
 */

//Step 1: initialize communication with the platform
var platform = new H.service.Platform({
  app_id: 'DemoAppId01082013GAL',
  app_code: 'AJKnXv84fjrb0KIHawS0Tg',
  useCIT: true,
  useHTTPS: true
});
var defaultLayers = platform.createDefaultLayers();

//Step 2: initialize a map - this map is centered over Europe
var map = new H.Map(document.getElementById('map'),
  defaultLayers.normal.map,{
  center: {lat:52.5160, lng:13.3779},
  zoom: 15
});

//Step 3: make the map interactive
// MapEvents enables the event system
// Behavior implements default interactions for pan/zoom (also on mobile touch environments)
var behavior = new H.mapevents.Behavior(new H.mapevents.MapEvents(map));

// Create the default UI components
var ui = H.ui.UI.createDefault(map, defaultLayers);

// Now use the map as required...
addMarkersToMap(map);
  </script>
</body>
</html>
